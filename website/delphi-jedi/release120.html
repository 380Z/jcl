<HTML>
<HEAD>
<TITLE>Jedi Code Library Release 1.20</TITLE>
</HEAD>

<BODY>
<PRE>

======================================================================
Jedi Code Library
Release 1.20
                                                           23-Mar-2002
======================================================================

It has been a long time since we released the last version of the Jedi
Code Library. Now, we are proud to present Version 1.20. It includes a
real bunch of bug fixes, some new features and even two completely
new units.

Furthermore we are introducing an Issue Tracker to help you and us to
solve JCL related problems as fast as possible. The times in which you
had to check the VCS, or contact someone from the team individualy to
retain information about the status of a specific bug are gone by now.

So far the good news, some less good news is that the team changed a
little bit. The former lead and main coordinator of the Code Library -
Marcel van Brakel - has left the team and moved on to other areas. We
hereby wish him good look and want to say &quot;thank you&quot; for all what he
has done. Please do not send any email regarding JCL support to him -
instead use the mailing list, the newsgroup or one of our email
accounts.

<B>* New features</B>

  New Unit: JclTD32     Introduces Borland TD32 symbolic debugging
                        information support routines and classes.

  New Unit: JclSvCtrl   This unit introduces various routines and
                        classes to control Windows NT services.

  JclAppInst
    - TJclAppInstances.SendCmdLineParams method added

  JclCounter
    - Linux compatability
    - You are now able to resume counting.

  JclDebug:
    - New feature: Borland TD32 debug symbols can be another source of
      source code location information
    - Improved: OffsetFromProcName and OffsetFromLineNumber items added
      to TJclLocationInfo structure to improve source location
      information
    - Improved: GetLocationInfoStr function has new default parameters
      for formatting new information added to TJclLocationInfo structure
    - Improved: Stack listing code has been optimized for performance.
      It should be at least twenty times faster than original code which
      is important for exceptional stack tracking
    - Improved: MAP file parser now accepts files with incorrect information
      (caused by bug in the linker) as well and corrects them. There is new
      TJclMapScanner.LineNumberErrors property indicating number of incorrect
      line number information in the MAP file
    - Improved: TJclDebugThread and TJclDebugThreadList classes
    - Added: TJclStackInfoItem.CallerAdr property
    - Added: TJclModuleInfoList class
    - Added: New LineNumberErrors parameter to ConvertMapFileToJdbgFile
             function
    - Added: New LineNumberErrors parameter to InsertDebugDataIntoExecutableFile
             function
    - Added: stStaticModuleList to TJclStackTrackingOption to improve
             performance of stack listing code for applications using statically
             linked modules only
    - Backward compatibility: ModuleFromAddr and IsSystemModule routines moved to
                              JclSysInfo unit. Its functionality is replaced by
                              TJclModuleInfoList class for better performance

  JclFileUtils
    - TJclMappedTextReader class added
    - New function: VersionFixedFileInfo
    - Function improved: ShredFile now uses an alternating bit
      pattern.

  JclMapi
    - Added: DefaultProfileName, ProfileCount and Profiles properties to
             TJclSimpleMapi class
    - Added: TJclEmail.HtmlBody property for creating HTML format messages

  JclMath
    - Rabin Miller strong primality test added

  JclMultimedia
    - Improved: CD Audio routines has additional parameter for specifying the
                drive
    - New function: GetCdInfo
    - New function: GetCDAudioTrackList
    - Added: Audio mixer classes

  JclPeImage
    - Added: TJclPeImage.IsCLR and TJclPeImage.CLRHeader properties
    - Added: TJclPeImage.CertificateList property
    - Added: TJclPeRootResourceList.ManifestContent property
    - Added: TJclPePackageInfo.Available property
    - Added: TJclPePackageInfo.EnsureExtension property
    - Added: TJclPeBorImage.PackageCompilerVersion property
    - Added: TJclPeBorImage.DependedPackages method
    - New function: PeBorDependedPackages
    - New function: PeClearCheckSum
    - New function: PeFindMissingImports
    - New function: PeCreateRequiredImportList
    - Backward compatibility: TJclPeBorImage.IsTD32DebugPresent property
                              removed. The functionallity is replaced by
                              JclTD32 unit

  JclRegistry
    - New function: RegKeyExists

  JclShell
    - New function: GetFileNameIcon

  JclStrings
    - New function: StrTrimCharsRight
    - New function: StrTrimCharsLeft
    - New function: StrNormIndex
    - New function: StrCharPosLower
    - New function: StrCharPosUpper

  JclSysInfo:
    - Now able to detect Crusoe chipsets.
    - Improved: Windows XP added to operating system info routines
    - Improved: GetPidFromProcessName accepts filename without full path
    - Added: Windows 95/98/Me system resources information routines
    - New function: GetShellProcessName
    - New function: GetShellProcessHandle
    - New function: GetWindowsServicePackVersion
    - New function: GetNtProductTypeString
    - New function: GetWindowsVersionString
    - New function: GetCommonAppdataFolder
    - New function: IsMainAppWindow
    - New function: GetWindowCaption
    - New function: GetMainAppWndFromPid

JclSysUtils
    - Added: TJclReferenceMemoryStream class
    - Added: TList binary search routines
    - Added: Dynamic arrays sorting and searching routines
    - New function: GetImplementorOfInterface


<B>* JCL Distribution content:</B>

Install.bat               - Compile and run JCL Install Helper
makefile.mak              - Builds all JCL examples and tools
Readme.txt
Bin                       - Folder for compiled JCL binaries
Dcu                       - Folder for DCU files
Examples                  - JCL example applications
Examples\DebugExtension   - JCL Debug IDE expert for using JclDebug unit
             \Dialog      - Sample application exception dialog replacement
             \ThreadNames - IDE expert showing class names for debugged threads
             \Tools       - Tools for creating files with JCL debug information
Examples\DelphiTools      - Collection of system tools using JCL
Examples\InstallHelper    - JCL Install Helper
Examples\ProjectAnalyzer  - Project Analyzer IDE expert
Help                      - Help file
Packages                  - JCL runtime package and project group containing all
                            available design-time packages
Source                    - JCL source code


<B>* Installation</B>

Supported development tools versions:

- Delphi 4 Update Pack #3
- Delphi 5 Update Pack #1
- Delphi 6 Update Pack #2 (including Personal Edition)
- Free Pascal compiler

Please make sure you have installed latest update packs. You can download them
from Borland Support web page: <A HREF="http://www.borland.com/devsupport/delphi/">http://www.borland.com/devsupport/delphi/</A>

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Important !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
! If you have installed any previous version of the JCL you have to delete it. !
! It is also necessary to remove all installed JCL packages from the IDE.      !
! Do not mix files or compiled packages from older versions of the JCL with    !
! current version.                                                             !
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

Because the JCL does NOT contain any components you don't have to install it to
the IDE. Just use desired unit(s) in your project (add them to uses clause) and
make sure IDE Library Path or Project Search Path contains JCL\Source folder,
i.e. C:\Delphi\JCL\Source (where C:\Delphi\JCL is folder when you have unzipped
the JCL archive).

- To set the path for all projects in IDE Library Path (recommended) go to:
  Tools|Environment Options -&gt; Library tab, add the path to Library Path field
  or use JCL Install Helper described later in the document

- To set the path for a project only (optional) go to:
  Project|Options -&gt; Directories/Conditionals page, add the path to Search path
  field

Although you might want to install additional experts or files shipped with the
JCL. Currently there are:

- Help file
- Sample application exception dialogs
- IDE experts

The installation process is described later in the document. You can use JCL
Install Helper for the first two options but IDE experts have to be installed
manually from the IDE.


<B>* JCL Install Helper</B>

Helps you to integrate Jedi Code Library with Delphi IDE. Currently it assists
with:

- Adding sample JCL Debug extension dialogs to Object Repository
- Adding JCL\Source path to Library Path in Environment Options
- Integrating JCL help file to the IDE.

To start it click on Install.bat file in the JCL root folder.


<B>* Packages</B>

In case you'd like to install any IDE expert shipped with JCL or use JCL code
in your components or IDE experts you need runtime package containing all JCL
source units. The package is located in Packages folder. There are separate
files for each Delphi version:

DJCL40.dpk - for Delphi 4
DJCL50.dpk - for Delphi 5
DJCL.dpk   - for Delphi 6

To simplify the process of installing additional packages we provide project
groups containing all JCL packages for particular Delphi version:

JclPackages40.bpg - for Delphi 4
JclPackages50.bpg - for Delphi 5
JclPackages60.bpg - for Delphi 6

Each group contains JCL runtime package and design-time packages for JCL IDE
experts:

DJCL             - JCL runtime package
JclDebugIde      - Expert for inserting JCL Debug information into executable
                   files. This is useful when use source location routines in
                   your application
ThreadNameExpert - Expert for displaying class names of TThread classes in
                   Thread Status window during debugging. See ThreadNamesExample
                   project in JCL\Examples folder
ProjectAnalyzer  - Expert showing list of units compiled to a current project
                   including the information how much a unit contributes to the
                   executable file size. It will add 'Analyze Project &lt;name&gt;'
                   item to the Project menu

To install it, open file matching your Delphi version, activate Project Manager
window in Delphi IDE, select DJCLxx file and build it from popup menu by Build
command. Then select desired designtime package(s) and install them one by one
by Install command from the popup menu. Then close the project group (answer
'No' when IDE asks to save changes in project group files).


<B>* Debug Extension for JclDebug unit</B>

Examples\DebugExtension folder contains IDE expert which assists to insert JCL
Debug information into executable files. This can be useful when use source
location routines from JclDebug unit. These routines needs some kind of special
information to be able provide source location for given address in the process.
Currently there are four options to get it work:

1. Generate and deploy MAP file with your executable file. The file is generated
   by the linker. It needs to be set in Project|Options dialog -&gt; Linker page,
   Detailed checkbox.

2. Generate and deploy JDBG file file with your executable file. This is binary
   file based on MAP file but its size is typically about 12% of original MAP
   file. You can generate it by MapToJdbg tool in JCL\Examples\Tools folder.
   The advantage over MAP file is smaller size and better security of the file
   content because it is not a plain text file and it also contains a checksum.

3. Generate Borland TD32 debug symbols. These symbols are stored directly in the
   executable file but usually adds several megabytes so the file is very large.
   The advantage is you don't have to deploy any other file and it is easy to
   generate it by checking Include TD32 debug info in Linker option page.

4. Insert JCL Debug info into executable file by the IDE expert. The size of
   added data is similar to JDBG file but it will be inserted directly into the
   executable file. This is probably best option because it combines small size
   of included data and no requirement of deploying additional files. In case
   you use this option you need install the JclDebugIde expert.

The IDE expert will add new item to IDE Project menu. Due some differences in
Open Tools API the use of the expert is slightly different in Delphi 4. For
Delphi 5 and 6 it adds 'Insert JCL Debug data' check item at the end of the
Project menu. When the item is checked, everytime the project is compiled by one
of following commands: Compile, Build, Compile All Projects, Build All Projects
or Run necessary JCL debug data are automatically inserted into the executable.
Moreover, for Build and Build All commands dialog with detailed information of
size of these data will be displayed. For Delphi 4 there is 'Build JCL Debug'
command only in the Project menu which performs a build including these data.

You can generate those debug data for packages and libraries as well using the
expert. Each executable file in the project can use different option from those
listed above. It is not necessary to generate any debug data for Borland runtime
packages because the source location code can use names of exported functions
to get procedure or method name. To get line number information for Borland RTL
and VCL/CLX units you have to check Use Debug DCUs checkbox in Project|Options
dialog -&gt; Compiler tab (not available in Delphi 4). Unfortunately it is not
possible to get line number information for Borland runtime packages because
Borland does not provide detailed MAP files for them so you get procedure or
method name only.

In case you have more than one data source for an executable file by an accident
the best one is chosen in following order:

1. JCL Debug data in the executable file
2. JDBG file
3. Borland TD32 symbols
4. MAP file
5. library or Borland package exports

It is also possible to insert JCL debug data programmatically to the executable
file by using MakeJclDbg command line tool in JCL\Examples\Tools folder. You can
study included makefiles which uses this tool for building DelphiTools examples.

To help using JclDebug exceptional stack tracking in application simple dialog
is provided in JCL\Examples\DebugExtension\Dialog folder. The dialog replaces
standard dialog displayed by VCL or CLX application when an unhandled exception
occurs. It has additional Detailed button showing the stack, list of loaded
modules and other system information. By adding the dialog to the application
exceptional stack tracking code is automatically initialized so you don't have
to care about it. You can also turn on logging to text file by setting the Tag
property of the dialog to '1'. There is also version for CLX (ClxExceptDlg) but
it works on Windows only. These dialogs are intended to be added to Object
Repository.


<B>* Makefiles</B>

In order to compile all examples and tools by one command we provide makefiles.
To use them open Command Prompt, change current directory to root JCL directory
and run MAKE command. It should start to compile all project using most recent
version of compiler from installed Delphi versions. All executable files will be
created in JCL\Bin directory.


<B>* Feedback</B>

If you have any comments or suggestions we would appreciate it if you
drop us a note. There are several ways to get in contact with us:

  - Write to <A HREF="mailto:jcl@delphi-jedi.org">jcl@delphi-jedi.org</A> or to <A HREF="mailto:jcl-testing@delphi-jedi.org">jcl-testing@delphi-jedi.org</A>
    This email account should not be used for support requests. If
    you need support please use either the newsgroups or the
    mailing list.

  - If you want to keep up to date about JCL then you can join the
    JCL mailing list by going to <A HREF="http://www.egroups.com/group/JEDI-JCL">http://www.egroups.com/group/JEDI-JCL</A>
    You can also use this list to voice your opinion, comments or
    suggestions.

  - If you prefer a newsgroup over a mailing list please join us at
    <A HREF="news://forums.talkto.net/jedi.jcl">news://forums.talkto.net/jedi.jcl</A>. The newsgroup is the point where
    you can discuss the JCL with other users and with the team itself.


<B>* Issue Tracking</B>

We finally decided to use an issue tracking tool. It can be accessed
via either

<A HREF="http://jcl.sourceforge.net/">http://jcl.sourceforge.net/</A>

or

<A HREF="http://jcl.sourceforge.net/reportbug">http://jcl.sourceforge.net/reportbug</A>

The first link requires you register for a new login account.
The second one uses an anonymous account. You can enter and keep
track of bug reports as well as of feature requests.

The general rule is:

If you want to get a bug fixed you need to log it!

The JEDI issue tracker is based up on the Mantis BugTracker Open Source
project. More background information about it is available on its homepage
(<A HREF="http://mantisbt.sourceforge.net">http://mantisbt.sourceforge.net</A>)

Please be aware that you are allowed there to enter feature request
and code donations as well.

<B>* Version Control</B>

We are using FreeVCS as version control system. You can download it from
<A HREF="http://www.freevcs.de">http://www.freevcs.de</A>

To sychronize please use one of the following accounts:

server: demos.href.com
uid: jcluser[1|2|3]
pwd: jcluser


<B>* Bug fixes</B>

Jcl8087
  - FPC compatability added.

JclFileUtils
  - CreateEmptyFile fixed (#0000007)
  - AdvBuildFileList fixed - problem with Normal files (#0000030)

JclGraphics
  - FillLongWord replaced with OP.

JclMath
  - Removed the JclRangeSet and JclFlatSet classes
  - Bug fixed: Power (wrong results near zero)
  - Bug fixed: LCM has thrown a divide by zero when arg = 0
  - Bug fixed: Rational.Add did not work at all.
  - Bug fixed: Rational.Subtract did not work at all.

JclRegistry
  - Bug fixed: RegReadBinary and RegReadBinaryDef now accept
    REG_MULTI_SZ as well.

JclStrings
  - Bug fix: Rewrote StrSmartCase to fix a bug.
  - Bug fix: StrIsAlphaNumUnderscore
  - Bug fix: StrIsSubset
  - Bug fix: StrRepeatLength
  - Bug fix: StrLastPos

JclSysInfo
  - Bug fix: RunningProcessesList
  - Bug fix: Crusoe processor detection

</PRE>

</BODY>
</HTML>
