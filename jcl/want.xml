<?xml version="1.0"?>
<!--
{**************************************************************************************************}
{                                                                                                  }
{ Project JEDI Code Library (JCL)                                                                  }
{                                                                                                  }
{ The contents of this file are subject to the Mozilla Public License Version 1.1 (the "License"); }
{ you may not use this file except in compliance with the License. You may obtain a copy of the    }
{ License at http://www.mozilla.org/MPL/                                                           }
{                                                                                                  }
{ Software distributed under the License is distributed on an "AS IS" basis, WITHOUT WARRANTY OF   }
{ ANY KIND, either express or implied. See the License for the specific language governing rights  }
{ and limitations under the License.                                                               }
{                                                                                                  }
{ The Original Code is want.xml.                                                             	   }
{                                                                                                  }
{ The Initial Developer of the Original Code is documented in the accompanying                     }
{ help file JCL.chm. Portions created by these individuals are Copyright (C) of these individuals. }
{                                                                                                  }
{**************************************************************************************************}
{                                                                                                  }
{ This unit contains want script for build JCl.                                                    }
{                                                                                                  }
{ Unit owner: Flier Lu                                                                             }
{ Last modified: December 12, 2003 (Robert Rossmair)                                                }
{                                                                                                  }
{**************************************************************************************************}
-->
<project name="Project JEDI Code Library (JCL)" basedir="." default="help">
  <tstamp>
    <format property="when"         pattern="yyyy,mm,dd,HH,nn,ss"/>
    <format property="date.tag"     pattern="yyyy-mm-dd"/>
  </tstamp>

  <property name="app.fullname"     value="Project JEDI Code Library"/>
  <property name="app.shortname"    value="JCL"/>

  <property name="version.major"    value="1"/>
  <property name="version.minor"    value="90"/>
  <property name="version"          value="${version.major}.${version.minor}"/>

  <!-- why won't the following line work with subst=""? -->
  <regexp property="ver.dir" pattern="\.0" subst=" " text="d%{delphi.version}" />
  <property name="bpl.dir"          value="%{delphi.dir}/Projects/Bpl"/>
  <property name="bin.dir"          value="${basedir}/bin"/>
  <property name="lib.dir"          value="${basedir}/lib/${ver.dir}"/>
  <property name="dist.dir"         value="${basedir}/dist"/>
  <property name="qa.dir"           value="${basedir}/qa"/>
  <property name="samp.dir"         value="${basedir}/examples"/>
  <property name="doc.dir"          value="${basedir}/docs"/>
  <property name="help.dir"         value="${basedir}/help"/>
  <property name="pack.dir"         value="${basedir}/packages"/>
  <property name="pack.ver.dir"     value="${pack.dir}/${ver.dir}"/>
  <property name="src.dir"          value="${basedir}/source"/>

  <property name="zipname"          value="JCL${version.major}_${version.minor}.zip" />
  <property name="zipfile"          value="${dist.dir}/${zipname}" />

  <property name="prepare.hint"     value="prepare the directories" />
  <property name="clean.hint"       value="clean the binary files" />
  <property name="versioninfo.hint" value="show the version of JCL" />
  <property name="compile.hint"     value="compile library" />
  <property name="samples.hint"     value="compile the sample files" />
  <property name="dist.hint"        value="build .zip file" />

  <patternset id="src.dirs" >
    <include  name="${src.dir}/**" />
    <exclude  name="${src.dir}/prototypes" />
  </patternset>

  <patternset id="unit.dirs" >
    <include  name="${lib.dir}" />
    <patternset refid="src.dirs" />
  </patternset>

  <patternset id="samp.dirs" >
    <include  name="${samp.dir}/**" />
  </patternset>

  <patternset id="samples" >
    <include name="$(samp.dirs)/*.dpr" />
  </patternset>

  <patternset id="source.dirs" >
    <patternset refid="src.dirs" />
    <patternset refid="samp.dirs" />
  </patternset>

  <target name="help" >
    <echo message="Usage:" />
    <echo message="  want [target]" />
    <echo message="" />
    <echo message="Target:" />
    <echo message="  prepare      - ${prepare.hint}" />
    <echo message="  clean        - ${clean.hint}" />
    <echo message="  versioninfo  - ${versioninfo.hint}" />
    <echo message="  compile      - ${compile.hint}" />
    <echo message="  dist         - ${dist.hint}" />
  </target>

  <target name="prepare" description="${prepare.hint}" >
  </target>

  <target name="clean" description="${clean.hint}" >
    <!-- <delete dir="${dist.dir}" -->
    <delete file="**/*.~*" />
    <delete file="**/*.dcp" />
    <delete file="**/*.dcu" />
    <delete file="**/*.dpu" />
    <delete file="**/*.obj" />
    <delete file="**/*.o" />
    <delete file="**/*.rst" />
    <delete file="**/*.lib" />
    <delete file="**/*.bpi" />
    <delete file="${bin.dir}/*.exe" />
    <delete file="${bin.dir}/*.bpl" />
    <delete file="${bin.dir}/*.dll" />
    <delete file="${bin.dir}/*.map" />
  </target>

  <target name="versioninfo" description="${versioninfo.hint}" >
    <echo message="${app.fullname} (${app.shortname}) ${version}" />
  </target>

  <target name="compile" depends="clean,prepare,versioninfo" description="${compile.hint}" >
    <echo message="compile the source files..." />
    <brcc file="${src.dir}/windows/JclUnicode.rc" output="${src.dir}/windows/JclUnicode.res" />
    <dcc basedir="${pack.ver.dir}" source="DJcl*.dpk" >
      <dcuoutput path="${lib.dir}" />
      <exeoutput path="${bin.dir}" />
      <bploutput path="${bin.dir}" />
      <dcpoutput path="${lib.dir}" />
      <debug value="true" />
      <build value="true" />

      <unitpath refid="unit.dirs" />
      <includepath>
        <include    name="${src.dir}/common" />
      </includepath>
      <resourcepath>
        <include    name="${src.dir}/common" />
      </resourcepath>
    </dcc>
    <!-- make debug DCUs
    <dcc basedir="${src.dir}" source="common/*.pas" >
      <dcuoutput path="${lib.dir}/debug" />
      <debug value="true" />
      <build value="true" />
    </dcc>
    <dcc basedir="${src.dir}" source="vcl/*.pas" >
      <dcuoutput path="${lib.dir}/debug" />
      <debug value="true" />
      <build value="true" />
    </dcc>
    <dcc basedir="${src.dir}" source="visclx/*.pas" >
      <dcuoutput path="${lib.dir}/debug" />
      <debug value="true" />
      <build value="true" />
    </dcc>
    <dcc basedir="${src.dir}" source="windows/*.pas" >
      <dcuoutput path="${lib.dir}/debug" />
      <unitpath refid="unit.dirs">
        <include name="${basedir}/../Win32API" />
      </unitpath>
      <debug value="true" />
      <build value="true" />
    </dcc>
     -->
  </target>

  <target name="examples" depends="compile" description="${samples.hint}" >
    <echo message="" />
    <echo message="compile the sample files..." />

    <dcc basedir="${samp.dir}/visclx" source="**/*.pas">
      <exeoutput path="${bin.dir}" />
      <debug value="true" />
      <build value="true" />
      <unitpath>
        <include name="**" />
        <include name="${lib.dir}" />
      </unitpath>
      <includepath>
        <include name="${src.dir}/common" />
      </includepath>
    </dcc>

    <dcc basedir="${samp.dir}/vcl/delphitools" source="**/*.pas">
      <!-- usepackage name="designide" / -->
      <exeoutput path="${bin.dir}" />
      <debug value="true" />
      <build value="true" />
      <unitpath>
        <include name="${lib.dir}" />
      </unitpath>
      <includepath>
        <include name="${src.dir}/common" />
      </includepath>
    </dcc>

    <dcc basedir="${samp.dir}/vcl/debugextension" source="**/*.pas">
      <exeoutput path="${bin.dir}" />
      <debug value="true" />
      <build value="true" />
      <unitpath>
        <include name="%{delphi.dir}/Source/ToolsAPI" />
        <include name="${lib.dir}" />
      </unitpath>
      <includepath>
        <include name="${src.dir}/common" />
      </includepath>
    </dcc>

    <dcc basedir="${samp.dir}/vcl/debug" source="**/*.pas">
      <!-- usepackage name="designide" / -->
      <exeoutput path="${bin.dir}" />
      <debug value="true" />
      <build value="true" />
      <unitpath>
        <include name="${lib.dir}" />
      </unitpath>
      <includepath>
        <include name="${src.dir}/common" />
      </includepath>
    </dcc>

    <dcc basedir="${samp.dir}" source="**/*.dpk">
      <exeoutput path="${bin.dir}" />
      <debug value="true" />
      <build value="true" />
      <unitpath>
        <include name="**" />
        <include name="${lib.dir}" />
      </unitpath>
      <includepath>
        <include name="${src.dir}/common" />
      </includepath>
    </dcc>

    <dcc basedir="${samp.dir}" source="*.dpr">
      <exeoutput path="${bin.dir}" />
      <debug value="true" />
      <build value="true" />
      <unitpath>
        <include name="${lib.dir}" />
      </unitpath>
      <includepath>
        <include name="${src.dir}/common" />
      </includepath>
    </dcc>
  </target>

  <target name="dist" description="${dist.hint}" >
    <mkdir dir="${dist.dir}" />
    <delete file="${zipfile}" />
    <zip zipfile="${zipfile}" >
      <fileset dir="${basedir}\.." >
          <exclude name="${dist.dir}/**" />
          <exclude name="${qa.dir}/**" />
          <exclude name="${help.dir}/dtx/**" />
          <exclude name="${help.dir}/HIT/**" />
          <exclude name="${help.dir}/*.txt" />
          <exclude name="${pack.dir}/*.dev/**" />
          <exclude name="${pack.dir}/JclDevPackages*.bpg" />
          <exclude name="${pack.dir}/**/template.*" />
          <exclude name="${src.dir}/prototypes/**" />
          <exclude name="${src.dir}/unix/ProcessInfo.pas" />
          <exclude name="${samp.dir}/makefile.mak" />
          <exclude name="${src.dir}/common/*.inc" />
          <exclude name="${src.dir}/*.bat" />
          <exclude name="${basedir}/want.*" />

          <include name="${doc.dir}/**" />
          <include name="${basedir}/**/*.pas" />
          <include name="${basedir}/**/*.dfm" />
          <include name="${basedir}/**/*.xfm" />
          <include name="${basedir}/**/*.dof" />
          <include name="${basedir}/**/*.kof" />
          <include name="${basedir}/**/*.inc" />
          <include name="${basedir}/**/*.cpp" />

          <include name="${basedir}/**/*.dpr" />
          <include name="${basedir}/**/*.dpk" />
          <include name="${basedir}/**/*.bpg" />
          <include name="${basedir}/**/*.bpk" />
          <include name="${basedir}/**/*.mak" />

          <include name="${basedir}/**/*.rc" />
          <include name="${basedir}/**/*.res" />
          <include name="${basedir}/**/*.ico" />

          <include name="${help.dir}/JCLHelp.hlp" />
          <include name="${help.dir}/JCLHelp.cnt" />

          <include name="${basedir}/**/*.tlb" />

          <include name="${basedir}/**/*.txt" />
          <include name="${basedir}/**/*.htm" />
          <include name="${basedir}/**/*.html" />
          <!-- include name="${basedir}/**/*.xml" / -->
          <include name="${basedir}/**/*.bat" />
          <include name="install.bat" />
          <include name="readme.txt" />
      </fileset>
    </zip>
  </target>
</project>
